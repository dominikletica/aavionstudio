#!/usr/bin/env bash

set -euo pipefail

ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
cd "$ROOT_DIR"

echo ">>> Running composer install"
composer install --no-interaction --prefer-dist

echo ">>> Installing importmap assets"
php bin/console importmap:install --download=always

echo ">>> Building Tailwind assets"
php bin/console tailwind:build

echo ">>> Compiling asset map"
php bin/console asset-map:compile

echo ">>> Creating SQLite database (if needed)"
php bin/console doctrine:database:create --if-not-exists

echo ">>> Ensuring Messenger transports exist"
php bin/console messenger:setup-transports

echo ">>> Clearing and warming up cache"
php bin/console cache:clear
php bin/console cache:warmup

echo ">>> Repository initialisation complete."
