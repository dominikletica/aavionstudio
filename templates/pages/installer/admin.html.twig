{% extends 'layouts/installer.html.twig' %}
{% import 'partials/components/_macros.html.twig' as ui %}

{% block content %}
    {% include 'partials/components/section_heading.html.twig' with {
        title: 'Administrator account'|trans,
        subtitle: 'Create the first administrator, set their locale, and capture recovery contacts. The password is stored securely after the installer runs.'|trans
    } only %}

    <div class="grid gap-6 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]">
        <div class="surface rounded-md border border-border p-6 layout-stack layout-stack--loose">
            {{ form_start(admin_form, { attr: { class: 'layout-stack layout-stack--tight' } }) }}
                {% set admin_tooltip_badges = [] %}
                {% for entry in help['setup.admin']|default([]) %}
                    {% if entry.type|default('') == 'tooltip'
                        and entry.body is defined
                        and entry.body is not same as('')
                        and (entry.target is not defined or entry.target is same as(''))
                    %}
                        {% set admin_tooltip_badges = admin_tooltip_badges|merge([entry]) %}
                    {% endif %}
                {% endfor %}

                {% if admin_tooltip_badges is not empty %}
                    <div class="flex flex-wrap gap-2 text-xs font-medium text-text-muted">
                        {% for entry in admin_tooltip_badges %}
                            {% set tooltip_text = entry.body|striptags|replace({'\n': ' '})|trim %}
                            {% if tooltip_text %}
                                <span class="tooltip inline-flex items-center gap-2 rounded-full border border-border bg-surface-muted px-3 py-1"
                                      data-tooltip="{{ tooltip_text }}">
                                    <span aria-hidden="true" class="text-sm font-semibold text-text-muted">?</span>
                                    {{ entry.title|default('Tip') }}
                                </span>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endif %}

                <div class="grid gap-4 md:grid-cols-2">
                    {{ ui.form_row_with_tooltip(admin_form.email, help_tooltips['admin.email'] ?? null) }}
                    {{ ui.form_row_with_tooltip(admin_form.display_name, help_tooltips['admin.display_name'] ?? null) }}
                    {{ ui.form_row_with_tooltip(admin_form.password, help_tooltips['admin.password'] ?? null) }}
                    {{ ui.form_row_with_tooltip(admin_form.locale, help_tooltips['admin.locale'] ?? null) }}
                    {{ ui.form_row_with_tooltip(admin_form.timezone, help_tooltips['admin.timezone'] ?? null) }}
                    {{ ui.form_row_with_tooltip(admin_form.require_mfa, help_tooltips['admin.require_mfa'] ?? null) }}
                    {{ ui.form_row_with_tooltip(admin_form.recovery_email, help_tooltips['admin.recovery_email'] ?? null) }}
                    {{ ui.form_row_with_tooltip(admin_form.recovery_phone, help_tooltips['admin.recovery_phone'] ?? null) }}
                </div>
                <div class="flex justify-end">
                    {{ include('partials/components/button.html.twig', {
                        label: 'Save administrator'|trans,
                        attributes: { type: 'submit', class: 'btn btn-primary' }
                    }) }}
                </div>
            {{ form_end(admin_form) }}
        </div>

        <div class="layout-stack layout-stack--tight items-center">
            {% include 'partials/components/illustration.html.twig' with {
                name: 'add-user',
                variant: 'lg',
                attributes: { class: 'w-full max-w-md' },
                alt: 'Admin invitation illustration'|trans
            } only %}

            {% set admin_requirements %}
                <ul class="list-disc space-y-2 pl-5 text-sm leading-relaxed text-text-muted">
                    <li>{{ 'Create at least two administrators after launch to avoid lockouts during MFA rollout.'|trans }}</li>
                    <li>{{ 'Store recovery codes or backup tokens in a secure vault once MFA is enforced.'|trans }}</li>
                    <li>{{ 'Restrict SMTP access to the installer host to prevent spoofing while bootstrapping.'|trans }}</li>
                    <li>{{ 'Enable audit notifications so credential changes trigger alerts for the initial team.'|trans }}</li>
                </ul>
            {% endset %}

            {% include 'partials/components/card.html.twig' with {
                eyebrow: 'Good practice',
                title: 'Secure onboarding guidance',
                body: admin_requirements
            } only %}

            {% include 'partials/components/help_entries.html.twig' with {
                entries: help['setup.admin']|default([])
            } only %}
        </div>
    </div>
{% endblock %}
