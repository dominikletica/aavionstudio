{% extends 'layouts/installer.html.twig' %}
{% import 'partials/components/_macros.html.twig' as ui %}

{% block content %}
    {% include 'partials/components/section_heading.html.twig' with {
        title: 'installer.environment.heading.title'|trans,
        subtitle: 'installer.environment.heading.subtitle'|trans|raw
    } only %}

    <div class="grid gap-6 lg:grid-cols-[minmax(0,3fr)_minmax(0,2fr)]">
        <div class="surface rounded-md border border-border p-6 layout-stack layout-stack--loose">
            {{ form_start(environment_form, { attr: { class: 'layout-stack layout-stack--tight' } }) }}
                <div class="grid gap-4 md:grid-cols-2">
                    {{ ui.form_row_with_tooltip(environment_form.environment, help_tooltips['environment.environment'] ?? null) }}
                    {{ ui.form_row_with_tooltip(environment_form.debug, help_tooltips['environment.debug'] ?? null) }}
                    <div data-controller="setup-secret" data-setup-secret-message-value="{{ 'installer.environment.secret.generated'|trans }}" class="layout-stack layout-stack--tight">
                        {{ ui.form_row_with_tooltip(environment_form.secret, help_tooltips['environment.secret'] ?? null, {
                            attr: { 'data-setup-secret-target': 'input', autocomplete: 'off' }
                        }) }}
                        <div class="flex items-center gap-3">
                            {{ include('partials/components/button.html.twig', {
                                label: 'installer.environment.secret.generate'|trans,
                                attributes: {
                                    class: 'btn btn-secondary',
                                    'data-action': 'setup-secret#generate'
                                }
                            }) }}
                            <span data-setup-secret-target="feedback" class="hidden text-xs text-success font-medium" aria-live="polite">
                                {{ 'installer.environment.secret.generated'|trans }}
                            </span>
                        </div>
                    </div>
                    {{ ui.form_row_with_tooltip(environment_form.base_url, help_tooltips['environment.base_url'] ?? null) }}
                    {{ ui.form_row_with_tooltip(environment_form.instance_name, help_tooltips['environment.instance_name'] ?? null) }}
                    {{ ui.form_row_with_tooltip(environment_form.tagline, help_tooltips['environment.tagline'] ?? null) }}
                    {{ ui.form_row_with_tooltip(environment_form.support_email, help_tooltips['environment.support_email'] ?? null) }}
                    {{ ui.form_row_with_tooltip(environment_form.locale, help_tooltips['environment.locale'] ?? null) }}
                    {{ ui.form_row_with_tooltip(environment_form.timezone, help_tooltips['environment.timezone'] ?? null) }}
                    {{ ui.form_row_with_tooltip(environment_form.user_registration, help_tooltips['environment.user_registration'] ?? null) }}
                    {{ ui.form_row_with_tooltip(environment_form.maintenance_mode, help_tooltips['environment.maintenance_mode'] ?? null) }}
                </div>
                <div class="flex justify-end">
                    {{ include('partials/components/button.html.twig', {
                        label: 'installer.environment.actions.save'|trans,
                        attributes: { type: 'submit', class: 'btn btn-primary' }
                    }) }}
                </div>
            {{ form_end(environment_form) }}
        </div>
        <div class="layout-stack layout-stack--tight">
            {% include 'partials/components/illustration.html.twig' with {
                name: 'adjustments',
                variant: 'lg',
                attributes: { class: 'w-full' },
                alt: 'installer.environment.illustration_alt'|trans
            } only %}

            {% set overrides_body %}
                <ul class="list-disc space-y-2 pl-5 text-sm leading-relaxed text-text-muted">
                    <li><strong>APP_ENV</strong> – {{ 'installer.environment.overrides.app_env'|trans|raw }}</li>
                    <li><strong>APP_DEBUG</strong> – {{ 'installer.environment.overrides.app_debug'|trans }}</li>
                    <li><strong>APP_SECRET</strong> – {{ 'installer.environment.overrides.app_secret'|trans }}</li>
                    <li><strong>DEFAULT_URI</strong> – {{ 'installer.environment.overrides.default_uri'|trans }}</li>
                    <li><strong>MAILER_DSN</strong> – {{ 'installer.environment.overrides.mailer_dsn'|trans }}</li>
                </ul>
            {% endset %}

            {% include 'partials/components/card.html.twig' with {
                eyebrow: 'installer.environment.overrides.eyebrow'|trans,
                title: 'installer.environment.overrides.title'|trans,
                body: overrides_body
            } only %}

            {% set deployment_body %}
                <ol class="list-decimal space-y-3 pl-5 text-sm leading-relaxed text-text-muted">
                    <li>{{ 'installer.environment.readiness.copy_env'|trans|raw }}</li>
                    <li>{{ 'installer.environment.readiness.opcache'|trans|raw }}</li>
                    <li>{{ 'installer.environment.readiness.asset_rebuild'|trans|raw }}</li>
                    <li>{{ 'installer.environment.readiness.backups'|trans|raw }}</li>
                </ol>
            {% endset %}

            {% include 'partials/components/card.html.twig' with {
                eyebrow: 'installer.environment.readiness.eyebrow'|trans,
                title: 'installer.environment.readiness.title'|trans,
                body: deployment_body
            } only %}

            {% include 'partials/components/card.html.twig' with {
                variant: 'muted',
                title: 'ui.tip'|trans,
                body: '<p class="text-sm text-text-muted">' ~ 'installer.environment.tip'|trans ~ '</p>'
            } only %}

            {% include 'partials/components/help_entries.html.twig' with {
                entries: help['setup.environment']|default([])
            } only %}
        </div>
    </div>
{% endblock %}
