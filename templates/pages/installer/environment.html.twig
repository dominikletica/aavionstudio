{% extends 'layouts/installer.html.twig' %}

{% block content %}
    {% include 'partials/components/section_heading.html.twig' with {
        title: 'Environment defaults'|trans,
        subtitle: 'Review the values that will land in <code>.env.local</code> and in system settings. The installer validates everything before running <code>bin/init</code>.'|trans|raw
    } only %}

    <div class="grid gap-6 lg:grid-cols-[minmax(0,3fr)_minmax(0,2fr)]">
        <div class="surface rounded-md border border-border p-6 layout-stack layout-stack--loose">
            {{ form_start(environment_form, { attr: { class: 'layout-stack layout-stack--tight' } }) }}
                <div class="grid gap-4 md:grid-cols-2">
                    {{ form_row(environment_form.environment) }}
                    {{ form_row(environment_form.debug) }}
                    {{ form_row(environment_form.secret) }}
                    {{ form_row(environment_form.base_url) }}
                    {{ form_row(environment_form.instance_name) }}
                    {{ form_row(environment_form.tagline) }}
                    {{ form_row(environment_form.support_email) }}
                    {{ form_row(environment_form.locale) }}
                    {{ form_row(environment_form.timezone) }}
                    {{ form_row(environment_form.user_registration) }}
                    {{ form_row(environment_form.maintenance_mode) }}
                </div>
                <div class="flex justify-end">
                    {{ include('partials/components/button.html.twig', {
                        label: 'Save environment settings'|trans,
                        attributes: { type: 'submit', class: 'btn btn-primary' }
                    }) }}
                </div>
            {{ form_end(environment_form) }}
        </div>
        <div class="layout-stack layout-stack--tight">
            {% include 'partials/components/illustration.html.twig' with {
                name: 'adjustments',
                variant: 'lg',
                attributes: { class: 'w-full' },
                alt: 'Configuration illustration'|trans
            } only %}

            {% set overrides_body %}
                <ul class="list-disc space-y-2 pl-5 text-sm leading-relaxed text-text-muted">
                    <li><strong>APP_ENV</strong> – {{ 'Set <code>prod</code> for production installs; keep <code>dev</code> on staging boxes.'|trans|raw }}</li>
                    <li><strong>APP_DEBUG</strong> – {{ 'Disable debug outside of trusted environments to prevent verbose error output.'|trans }}</li>
                    <li><strong>APP_SECRET</strong> – {{ 'Generate a unique random value; never reuse secrets across instances.'|trans }}</li>
                    <li><strong>DEFAULT_URI</strong> – {{ 'Match the canonical base URL (including HTTPS) so CLI URL generators behave.'|trans }}</li>
                    <li><strong>MAILER_DSN</strong> – {{ 'Point to your SMTP or transactional provider before onboarding users.'|trans }}</li>
                </ul>
            {% endset %}

            {% include 'partials/components/card.html.twig' with {
                eyebrow: 'Configuration',
                title: 'Recommended overrides',
                body: overrides_body
            } only %}

            {% set deployment_body %}
                <ol class="list-decimal space-y-3 pl-5 text-sm leading-relaxed text-text-muted">
                    <li>{{ 'Copy the generated <code>.env.local</code> to your deployment target or secrets manager.'|trans|raw }}</li>
                    <li>{{ 'Enable opcache, configure PHP-FPM, and point the web server at <code>public/</code>.'|trans|raw }}</li>
                    <li>{{ 'Schedule the asset rebuild command (`php bin/console app:assets:rebuild --force`) for theme/module updates.'|trans|raw }}</li>
                    <li>{{ 'Back up <code>var/system.brain</code> and <code>var/user.brain</code> regularly; the storage step will add remote targets soon.'|trans|raw }}</li>
                </ol>
            {% endset %}

            {% include 'partials/components/card.html.twig' with {
                eyebrow: 'Readiness checklist',
                title: 'Before pushing to production',
                body: deployment_body
            } only %}

            {% include 'partials/components/card.html.twig' with {
                variant: 'muted',
                title: 'Tip'|trans,
                body: '<p class="text-sm text-text-muted">' ~ 'Values can be fine-tuned later in the admin UI; keep secrets out of version control.'|trans ~ '</p>'
            } only %}
        </div>
    </div>
{% endblock %}
