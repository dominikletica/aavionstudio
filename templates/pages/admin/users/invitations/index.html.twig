{% extends 'layouts/admin.html.twig' %}

{% set admin_title = 'admin.invitations.page_title'|trans %}

{% block content %}
    {% include 'partials/components/section_heading.html.twig' with {
        title: 'admin.invitations.heading.title'|trans,
        subtitle: 'admin.invitations.heading.subtitle'|trans
    } only %}

    <div class="grid gap-6 md:grid-cols-2">
        {% set create_body %}
            {{ form_start(createForm, { attr: { class: 'layout-stack layout-stack--tight' } }) }}
                {{ form_row(createForm.email) }}
                {{ include('partials/components/button.html.twig', {
                    label: 'admin.invitations.form.submit'|trans,
                    type: 'submit',
                    icon: 'mail'
                }, with_context = false) }}
            {{ form_end(createForm) }}
        {% endset %}

        {% include 'partials/components/card.html.twig' with {
            eyebrow: 'admin.invitations.create.eyebrow'|trans,
            title: 'admin.invitations.create.title'|trans,
            subtitle: 'admin.invitations.create.subtitle'|trans,
            body: create_body,
            attributes: { id: 'create-invitation' }
        } only %}

        {% if invitations is empty %}
            {% include 'partials/components/card.html.twig' with {
                variant: 'muted',
                title: 'admin.invitations.empty.card_title'|trans,
                body: include('partials/components/empty_state.html.twig', {
                    title: 'admin.invitations.empty.title'|trans,
                    description: 'admin.invitations.empty.description'|trans,
                    actions: [
                        {
                            label: 'admin.invitations.form.submit'|trans,
                            icon: 'mail',
                            tag: 'a',
                            url: '#create-invitation'
                        }
                    ]
                }, with_context = false)|raw
            } only %}
        {% else %}
            {% set invitation_rows = [] %}
            {% for invitation in invitations %}
                {% set status_badge %}
                    <span class="badge badge--info">{{ ('admin.invitations.status.' ~ invitation.status)|trans }}</span>
                {% endset %}
                {% if invitation.status == 'pending' %}
                    {% set cancel_button %}
                        <form method="post" action="{{ path('admin_user_invitations_cancel', { id: invitation.id }) }}" class="inline-flex justify-end">
                            <input type="hidden" name="_token" value="{{ csrf_token('cancel_invite_' ~ invitation.id) }}">
                            <button class="btn btn-secondary btn--sm" type="submit">{{ 'admin.invitations.actions.cancel'|trans }}</button>
                        </form>
                    {% endset %}
                {% else %}
                    {% set cancel_button %}
                        <span class="text-xs text-text-muted uppercase tracking-wide">{{ 'admin.invitations.status.completed'|trans }}</span>
                    {% endset %}
                {% endif %}
                {% set invitation_rows = invitation_rows|merge([{
                    email: invitation.email,
                    status: status_badge,
                    created: invitation.createdAt|format_datetime(pattern='region.datetime.short'|trans),
                    expires: invitation.expiresAt|format_datetime(pattern='region.datetime.short'|trans),
                    actions: cancel_button
                }]) %}
            {% endfor %}

            {% include 'partials/components/card.html.twig' with {
                eyebrow: 'admin.invitations.list.eyebrow'|trans,
                title: 'admin.invitations.list.title'|trans,
                subtitle: 'admin.invitations.list.subtitle'|trans,
                body: include('partials/components/table.html.twig', {
                    columns: [
                        { label: 'admin.invitations.table.columns.email'|trans, key: 'email', class: 'font-medium' },
                        { label: 'admin.invitations.table.columns.status'|trans, key: 'status', template: 'partials/components/table/value_raw.html.twig' },
                        { label: 'admin.invitations.table.columns.created'|trans, key: 'created', class: 'whitespace-nowrap text-sm text-text-muted' },
                        { label: 'admin.invitations.table.columns.expires'|trans, key: 'expires', class: 'whitespace-nowrap text-sm text-text-muted' },
                        { label: 'admin.invitations.table.columns.actions'|trans, key: 'actions', template: 'partials/components/table/value_raw.html.twig', class: 'text-right' }
                    ],
                    rows: invitation_rows,
                    compact: true
                }, with_context = false)|raw
            } only %}
        {% endif %}
    </div>
{% endblock %}
